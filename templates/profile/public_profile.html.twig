{% extends 'base.html.twig' %}

{% block title %}Profil de {{ userProfile.username }}{% endblock %}

{% block body %}
<section id="public-profile" class="max-w-5xl mx-auto py-10 px-4">

    <div class="flex flex-col items-center mb-10">
        <div class="relative w-32 h-32 rounded-full overflow-hidden border-4 border-violet-100 shadow-md mb-4">
            {% if userProfile.profilePicture %}
                {% if userProfile.googleId %}
                    <img src="{{ userProfile.profilePicture }}" alt="Photo de profil" class="w-full h-full object-cover">
                {% else %}
                    <img src="{{ asset('uploads/' ~ userProfile.profilePicture) }}" alt="Photo de profil" class="w-full h-full object-cover">
                {% endif %}
            {% else %}
                <img src="{{ asset('images/default-avatar.png') }}" alt="Avatar par défaut" class="w-full h-full object-cover opacity-80">
            {% endif %}
        </div>
        <h1 class="text-2xl font-semibold text-violet-700">{{ userProfile.username }}</h1>
        <p class="text-gray-500 text-sm mt-1">
            Membre depuis le {{ userProfile.registrationDate|date('d/m/Y') }}
        </p>
    </div>

    <section class="mb-12">
        <h2 class="text-xl font-semibold text-violet-700 mb-4">Itinéraires publics</h2>

        {% if itinerariesData is empty %}
            <p class="text-gray-500">Aucun itinéraire public pour le moment.</p>
        {% else %}
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                {% for data in itinerariesData %}
                    {% set itinerary = data.itinerary %}
                    <div class="border border-gray-200 rounded-lg shadow-sm p-4 bg-white hover:shadow-md transition">
                        <h3 class="text-violet-700 font-semibold text-lg mb-2 truncate">{{ itinerary.itineraryName }}</h3>

                        {% if itinerary.departureDate %}
                            <p class="text-sm text-gray-600 mb-1">
                                <i class="fa-regular fa-clock mr-1 text-violet-600"></i>
                                Départ le {{ itinerary.departureDate|date('d/m/Y') }}
                            </p>
                        {% endif %}

                        {% if itinerary.duration %}
                            <p class="text-sm text-gray-600 mb-1">
                                <i class="fa-solid fa-route mr-1 text-violet-600"></i>
                                Durée : {{ itinerary.duration }} jour{{ itinerary.duration > 1 ? 's' }}
                            </p>
                        {% endif %}

                        <a href="{{ path('public_itinerary_detail', { itineraryId: itinerary.id }) }}"class="text-sm text-violet-700 underline hover:text-violet-900">
                            Voir l’itinéraire
                        </a>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </section>

    <section>
        <h2 class="text-xl font-semibold text-violet-700 mb-4">Avis laissés</h2>

        {% if ratingsData is empty %}
            <p class="text-gray-500">Aucun avis publié pour le moment.</p>
        {% else %}
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                {% for data in ratingsData %}
                    {% set rating = data.rating %}
                    {% set locationName = data.locationName %}

                    <div class="border border-gray-200 rounded-lg shadow-sm p-4 hover:shadow-md transition">
                        <div class="flex items-center justify-between mb-2">
                            <p class="text-violet-700 font-semibold truncate">{{ locationName ?? 'Lieu inconnu' }}</p>
                            <div class="text-yellow-500 text-sm">
                                {{ rating.rating|stars|raw }}
                            </div>
                        </div>

                        {% if rating.comment %}
                            <p class="text-gray-700 text-sm italic mb-2">“{{ rating.comment }}”</p>
                        {% endif %}

                        <p class="text-xs text-gray-500">
                            <i class="fa-regular fa-calendar mr-1 text-violet-600"></i>
                            Posté le {{ rating.ratingDate|date('d/m/Y') }}
                        </p>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </section>
</section>
{% endblock %}
