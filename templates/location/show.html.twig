{% extends 'base.html.twig' %}
{% block title %}{{ location.locationName }} - Détail du lieu{% endblock %}
{% block meta_description %}
    Découvrez {{ location.locationName }} à {{ location.city }} : {{ location.description|striptags|slice(0, 160) }}...
{% endblock %}

{% block body %}
    <div>
        {% if location.images|length > 0 %}
            <figure class="h-64 w-full block lg:hidden">
                <img src="{{ location.images[0].imageName }}" alt="{{ location.locationName}}" loading="lazy" class="w-full h-full object-cover">
            </figure>
        {% endif %}

        <div class="my-5 mx-6  lg:mx-44">
            <div class="flex flex-col lg:flex-row lg:gap-12 gap-8 lg:mt-10">
 
                <div class="lg:w-2/3">          

                    <div class="flex flex-col lg:flex-row gap-10">
                   
                        <div class="lg:w-2/3">
                            <div class="flex items-center justify-between lg:justify-start lg:gap-4">
                                <h1 class="text-2xl lg:text-3xl text-left mb-1 font-semibold ">{{ location.locationName }}</h1>
                                <div class="flex gap-2 text-gray-800 font-light">
                                    <p>4,1</p>
                                    <div class="text-[0.75rem]">{{ 4|stars|raw }}</div>
                                    <p>(102)</p>
                                </div>
                            </div>
                            <p class="text-gray-500 mt-2">{{ location.type.typeName }}</p>
                            {# discount #}
                            {% if location.discounts|length > 0 %}
                                {% for discount in location.discounts %}
                                    {% if discount.isActive %}
                                    <div class="border border-violet-700 rounded-md py-2 px-4 flex items-center gap-3 mt-4 lg:mb-5 bg-violet-100 md:w-fit lg:w-fit w-full">
                                        <i class="fa-solid fa-tags text-violet-700"></i>
                                        <p  class=" font-medium text-violet-700">Code : <span class="font-semibold">{{ discount.code }}</span>  offrant {{ discount.percentage }}% de réduction</p>
                                    </div>
                                    {% endif %}
                                {% endfor %}
                            {% endif %}

                        </div>
                    
                        <div class="lg:w-1/3 flex flex-col">
                            <div class="flex justify-between items-center mt-2 lg:mt-0">
                                <p class="font-semibold text-[1.1rem]">Vous l'avez déjà visité?</p>
                                <label for="visited-switch" class="inline-flex items-center cursor-pointer">
                                    <input id="visited-switch" type="checkbox" value="" class="sr-only peer" checked aria-checked="true" aria-label="Lieu déjà visité">
                                    <div class="relative w-11 h-6 bg-gray-200 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-violet-800 dark:peer-checked:bg-violet-800"></div>
                                </label>
                            </div>
                            <div class="my-8 w-full flex justify-center lg:mt-6 lg:mb-8">
                                <p class="bg-violet-800 px-12 py-3 lg:py-2 rounded-3xl text-white font-medium text-center w-fit lg:w-full lg:rounded-2xl btn-violet">
                                    <a href="#">Ajouter à mon itinéraire</a>
                                </p>
                            </div>
                        </div>
                    </div>  
        
                    <ul class="flex justify-between mb-6 font-medium text-[1.1rem] py-3 sticky top-0 z-30 px-5 bg-white shadow-bottom lg:hidden ">
                        <li><a href="#description" id="nav-description" aria-label="Aller à la description"  class="underline-bar">Description </a></li>
                        <li><a href="#contact"  id="nav-contact" aria-label="Aller au contact" class="underline-bar" >Contact</a></li>
                        <li><a href="#infos"  id="nav-infos" aria-label="Aller aux infos" class="underline-bar">Infos</a></li>
                        <li><a href="#reviews" id="nav-reviews" aria-label="Aller aux avis" class="underline-bar">Avis</a></li>
                    </ul>


                    
                    <p id="description" class="text-justify lg:text-[0.9rem] ">{{ location.description}}</p>
                    <div class="mt-7 lg:mt-3 lg:grid lg:grid-cols-2 flex flex-col gap-8">
                        <div class="flex flex-col gap-8 lg:gap-6">

                            {# ----------------- CONTACT ----------------- #}
                            <section id="contact" class="mt-7">
                                <div class="flex gap-2 items-center mb-5">
                                    <i class="fa-solid fa-address-card text-violet-700" ></i>
                                    <p class="text-[1.1rem] font-semibold ">Contact</p>
                                </div>
                                <div class="flex gap-5">
                                    <div class="flex gap-3 items-center bg-violet-100 py-3 px-5 rounded-3xl">
                                        <i class="fa-solid fa-phone text-violet-700"></i>
                                        <p class="text-violet-700 font-medium">{{ location.phoneNumber }}</p>
                                    </div>
                                    {% if location.website %}
                                        <div class="flex gap-2 items-center bg-violet-100 py-3 px-5 rounded-3xl btn-violet-light">
                                            <i class="fa-solid fa-globe text-violet-700" ></i>
                                            <a href="{{ location.website }}" target="_blank" class="text-violet-700 font-medium">Site web</a>
                                        </div>
                                    {% endif %}
                                </div>
                            </section>

                            {# ----------------- HORAIRES ----------------- #}
                            <section id="infos" class="mt-7">
                                <div class="flex gap-2 items-center mb-5">
                                    <i class="fa-regular fa-clock text-violet-700"></i>
                                    <p class="text-[1.1rem] font-semibold text-black ">Horaires</p>
                                </div>
                                {# TODO : changer horaires #}
                                <p class="text-black font-normal">Variables selon la saison, à consulter sur le site internet.</p>
                            </section>
                        </div>
                        <div class="flex flex-col gap-8 lg:gap-6">

                            {# ----------------- ADRESSE ----------------- #}
                            <section class="mt-7">
                                <div class="flex gap-2 items-center mb-5">
                                    <i class="fa-solid fa-location-dot text-violet-700"></i>
                                    <p class="text-[1.1rem] font-semibold text-black ">Adresse</p>
                                </div>
                                <p class="text-black font-normal">{{ location.address}}, {{ location.zipcode }} {{ location.city }}</p>
                            </section>

                            {# ----------------- PRIX ----------------- #}
                            <section class="mt-7">
                                <div class="flex gap-2 items-center mb-5">
                                    <i class="fa-solid fa-coins text-violet-700"></i>
                                    <p class="text-[1.1rem] font-semibold text-black ">Prix</p>
                                </div>
                                {# TODO : récupérer les prix et les associer à une gamme de prix #}
                                <p class="text-black font-normal">Le propriétaire a indiqué une fourchette de prix allant de 150€ à 300€.</p>
                            </section>
                        </div>
                    </div>

                     {# ----------------- CARTE ----------------- #}
                    <section>
                        <div 
                            id="map" 
                            class="w-full  rounded-lg h-36 mt-8 inset-shadow-sm inset-shadow-gray-400"
                            data-lat="{{ location.latitude }}"
                            data-long="{{ location.longitude }}"
                        >
                        </div>
                    </section>
                </div>    
       
                <div class="hidden lg:block w-px bg-gray-200 mx-2"></div>
                <div class="lg:w-1/3">
                    {# ----------------- IMAGES ----------------- #}
                    <section>
                        <div class="flex gap-2 items-center mb-5">
                            <i class="fa-regular fa-images text-violet-700"></i>
                            <p class="text-[1.1rem] font-semibold text-black ">Photos</p>
                        </div>
                            <div class="wrapper-container-place">
                                <div style="--swiper-navigation-color: #fff; --swiper-pagination-color: #fff" class="swiper mySwiper2">
                                    <div class="swiper-wrapper">
                                        {% for image in location.images %}
                                            <figure class="swiper-slide">
                                                <img src="{{ image.imageName }}" alt="{{ location.locationName}}" >
                                            </figure>
                                        {% endfor %}
                                    </div>
                                    <div class="swiper-button-next"></div>
                                    <div class="swiper-button-prev"></div>
                                </div>
                                <div thumbsSlider="" class="swiper mySwiper">
                                    <div class="swiper-wrapper">
                                        {% for image in location.images %}
                                    
                                            <figure class="swiper-slide h">
                                                <img src="{{ image.imageName }}" alt="{{ location.locationName}}" >
                                            </figure>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                    </section>

                    {# ----------------- AVIS ----------------- #}
                    <section id="reviews" class="mt-7">
                        {#  TODO : faire carousel d'avis #}
                        <div class="lg:flex lg:justify-between lg:mb-3">
                            <div class="flex gap-2 items-center mb-5">
                                <i class="fa-regular fa-star text-violet-700"></i>
                                <p class="text-[1.1rem] font-semibold text-black ">Avis</p>
                            </div>
                            <div class="hidden lg:block">
                                <p class=" bg-violet-800 px-12 py-2 rounded-2xl text-white font-medium text-center w-fit btn-violet" >
                                    <a href="#">Laisser un avis</a>
                                </p>
                            </div>  

                        </div>
                        {# TODO : récupérer les avis associés à l'ID du lieu  #}
                        <div class="h-32 max-h-32 line-clamp-4 border border-violet-200 rounded-xl py-3 px-4">
                            <div class="flex justify-between mb-1">
                                <div class=" text-violet-700 text-[0.75rem] ">{{ 4|stars|raw}}</div>
                                {# TODO : récupérer vrai nom + vraie date #}
                                <p class="text-[0.75rem] text-gray-500">Camille - 25 octobre 2025</p>
                            </div>

                            <p class=" text-[0.9rem]">J’ai adoré mon séjour. Cet hôtel est vraiment superbe, le petit déjeuner est très bon ! Vous pouvez y aller sans hésiter ! Les chambres sont très propres et belles</p>
                        </div>

                        <div class="my-8 w-full flex justify-center lg:hidden">
                            <p class="bg-violet-800 px-12 py-3 rounded-3xl text-white font-medium text-center w-fit" >
                                <a href="#">Laisser un avis</a>
                            </p>  
                        </div>
                    </section>

                </div>
            </div>
        </div>
    
        {# ----------------- A PROXIMITE ----------------- #}
        <section class="mt-7 h-64  bg-[#393939] p-5 lg:px-44">           
            <h2 class="text-white font-semibold text-xl">À proximité</h2>                 
        </section>
    </div>

    
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src='https://unpkg.com/maplibre-gl@5.6.1/dist/maplibre-gl.js'></script>
    {# <script src="{{ asset('js/map.js') }}"></script> #}
    <script>
        document.addEventListener('scroll', () => {
            const sections = ['description', 'contact', 'infos', 'reviews'];
            let active = sections[0];

            for(const id of sections) {
                const element = document.getElementById(id);
                if(element && element.getBoundingClientRect().top <= 80 ) {
                    active = id;
                }
            }

            sections.forEach(id => {
                const nav = document.getElementById('nav-' + id);
                if(nav) nav.classList.toggle('active-underline', id === active);  
            });
        });


        document.addEventListener('DOMContentLoaded', function(){
            const swiper = new Swiper(".mySwiper", {
                loop: true,
                spaceBetween: 10,
                slidesPerView: 3,
                
                freeMode: true,
                watchSlidesProgress: true,
            });
            const swiper2 = new Swiper(".mySwiper2", {
                loop: true,
                spaceBetween: 10,
                mousewheel: true,
                navigation: {
                    nextEl: ".swiper-button-next",
                    prevEl: ".swiper-button-prev",
                },
                thumbs: {
                    swiper: swiper,
                },
            });

            const mapDiv = document.getElementById('map');
            const lat = parseFloat(mapDiv.dataset.lat);
            const long = parseFloat(mapDiv.dataset.long);

            const map = new maplibregl.Map({
                container: 'map',
                style: "https://api.jawg.io/styles/jawg-lagoon.json?access-token=5Hj1eNrhxICEmCUA3n50cFITkKNPsXWcZFw3JKMebObcRBGRIBQnT1RQlRQ4RRoG",
                zoom: 16,
                center: [long, lat]
            });
            maplibregl.setRTLTextPlugin(
                'https://unpkg.com/@mapbox/mapbox-gl-rtl-text@0.3.0/dist/mapbox-gl-rtl-text.js'
            );

            const element = document.createElement('div');
            element.style.backgroundImage = 'url("/img/regular-pin-small.png")';
            element.style.width = "45px";
            element.style.height = "45px";
            element.style.backgroundSize = "100%";

            new maplibregl.Marker({element: element}).setLngLat([long, lat]).addTo(map);
        });
    </script>

{% endblock %}